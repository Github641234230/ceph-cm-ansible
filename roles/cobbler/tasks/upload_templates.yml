---
- name: Get keys for the teuthology_user.
  uri:
    # TODO: make a var
    url: "https://raw.github.com/ceph/keys/autogenerated/ssh/@all.pub"
    return_content: yes
  register: _teuthology_user_keys
  tags:
    - always

- name: Create the teuthology_user_keys var.
  set_fact:
    teuthology_user_keys: "{{ _teuthology_user_keys.content }}"
  when: _teuthology_user_keys.content is defined
  tags:
    - always

- name: Upload kickstarts and preseeds.
  template:
    src: "kickstarts/{{ item }}"
    dest: "/var/lib/cobbler/kickstarts/{{ item }}"
    owner: root
    group: root
    mode: 0644 
  with_items: kickstarts
  tags:
    - kickstarts

- name: Upload snippets
  template:
    src: "snippets/{{ item }}"
    dest: "/var/lib/cobbler/snippets/{{ item }}"
    owner: root
    group: root
    mode: 0644
  with_items: snippets
  tags:
    - snippets

- name: Upload scripts.
  template:
    src: "scripts/{{ item }}"
    dest: "/var/lib/cobbler/scripts/{{ item }}"
    owner: root
    group: root
    mode: 0644
  with_items: scripts
  tags:
    - scripts
